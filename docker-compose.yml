services:
  db:
    image: surrealdb/surrealdb:v2
    container_name: agentuidb-db
    user: "0"
    command: start --bind 0.0.0.0:8000 --user root --pass root file:/data
    ports:
      - "${DB_PORT:-8000}:8000"
    volumes:
      - surrealdb-data:/data
      - ./scripts/seed-data.surql:/seed-data.surql:ro
    healthcheck:
      test: ["CMD", "/surreal", "is-ready", "--endpoint", "http://localhost:8000"]
      interval: 5s
      timeout: 3s
      retries: 5
    restart: unless-stopped

  mcp:
    container_name: agentuidb-mcp
    build:
      context: ./mcp
    ports:
      - "${MCP_PORT:-3001}:3001"
    environment:
      - AGENTUIDB_URL=http://db:8000
      - PORT=3001
    depends_on:
      db:
        condition: service_healthy
    restart: unless-stopped

  dashboard:
    container_name: agentuidb-dashboard
    build:
      context: ./dashboard
    ports:
      - "${DASHBOARD_PORT:-3000}:3000"
    environment:
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY:-}
    depends_on:
      db:
        condition: service_healthy
    restart: unless-stopped

volumes:
  surrealdb-data:
